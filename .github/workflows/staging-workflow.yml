name: Staging translated Qiskit docs

on:
  pull_request:
    branches: [ master ]
  label:
     types: [ gh-pages ]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        language:
          - bn_BN
          - de_DE
          - es_ES
          - es_MX
          - fr_FR
          - hi_IN
          - id_ID
          - it_IT
          - ja_JP
          - ko_KR
          - pl_PL
          - pt_BR
          - tr_TR

    job1:
      if: contains( github.event.pull_request.labels.*.name, 'gh-pages' )
      steps:
      - uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -U virtualenv setuptools wheel
          pip install -U -r requirements-dev.txt sphinx-intl qiskit
          sudo apt-get install graphviz pandoc

      - name: Build translated Qiskit Docs
        env:
          TRANSLATION_LANG: ${{ matrix.language }}
        run: |
          tools/staging_translated_documentation.sh

    job2:
      needs: job1
      steps:
      - name: Install SSH Client
        uses: webfactory/ssh-agent@v0.2.0
        with:
            ssh-private-key: ${{ secrets.GH_PAGES_DEPLOY_KEY }}

      - name: Deploy to gh-pages
        uses: JamesIves/github-pages-deploy-action@3.6.2
        with:
          BASE_BRANCH: master
          BRANCH: gh-pages
          FOLDER: build
          CLEAN_EXCLUDE: '["README.md", "index.html", "qiskit_header.png"]'
          ACTIONS_STEP_DEBUG: true
          SSH: true
